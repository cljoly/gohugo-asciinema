{{/*
 * SPDX-License-Identifier: Apache-2.0
 * Copyright Cl√©ment Joly and contributors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/}}


{{- if eq (.Page.Scratch.Get "GoHugoAsciinemaPlayerShortcode") nil }}
  {{- with resources.Get "js/asciinema-player.min.js"
    | resources.Fingerprint "md5" }}
    <script src="{{ .Permalink }}"></script>
  {{- end }}
  {{- with resources.Get "css/asciinema-player.css"
    | resources.Minify
    | resources.Fingerprint "md5" }}
    <link rel="stylesheet" type="text/css" href="{{ .Permalink }}" />
  {{- end }}

    {{- .Page.Scratch.Set "GoHugoAsciinemaPlayerShortcode" 0 }}
{{- end }}
{{- $time := .Page.Scratch.Get "GoHugoAsciinemaPlayerShortcode" }}
{{- $time := add $time 1 }}
{{- .Page.Scratch.Set "GoHugoAsciinemaPlayerShortcode" $time }}
{{- $mergedParams := merge $.Site.Params.asciinema.defaults .Params -}}

<div id="demo{{ $time }}"></div>
<script>
AsciinemaPlayer.create({{ .Get "src" }}, document.getElementById('demo{{ $time }}'), {
{{ range $key, $value := $mergedParams }}
    {{- if ne $key "src" }}
        {{- $key }}: {{ $value }},
    {{- end }}
{{- end }}
});
</script>
<noscript><blockquote><p>To run this asciicast without javascript, use <code>asciinema play {{.Get "src" | absURL }}</code> with <a href="https://asciinema.org/">Asciinema</a></p></blockquote></noscript>
